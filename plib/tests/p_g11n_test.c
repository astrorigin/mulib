#include <p_g11n.h>

#include <p_mempool.h>

P_INT32
p_l10n_test( P_VOID )
{
#ifndef P_NO_MEMPOOL
    p_MemPool mp;
#endif
    /* test vector */
    const char strings[] = {
    0x0,0x48,0x65,0x6C,0x6C,0x6F,0x20,0x54,0x72,0x61,0x6E,0x73,0x6C,0x61,0x74,0x69,
    0x6F,0x6E,0x0,0x0,0x47,0x75,0x74,0x65,0x6E,0x20,0x54,0x61,0x67,0x0,0x0,0x43,0x6F,
    0x6E,0x74,0x65,0x78,0x74,0x75,0x61,0x6C,0x20,0x69,0x6E,0x66,0x6F,0x72,0x6D,0x61,
    0x74,0x69,0x6F,0x6E,0x0,0x43,0x6C,0x69,0x63,0x6B,0x20,0x68,0x65,0x72,0x65,0x0,
    0x0,0x43,0x6C,0x69,0x63,0x6B,0x20,0x64,0x61,0x0,0x0,0x0,0x49,0x20,0x61,0x6D,0x0,
    0x57,0x65,0x20,0x61,0x72,0x65,0x0,0x49,0x63,0x68,0x20,0x62,0x69,0x6E,0x0,0x57,
    0x69,0x72,0x20,0x73,0x69,0x6E,0x64,0x0,0x43,0x6F,0x6D,0x70,0x6C,0x69,0x63,0x61,
    0x74,0x65,0x64,0x0,0x79,0x6F,0x75,0x20,0x67,0x6F,0x74,0x20,0x69,0x74,0x0,0x79,
    0x6F,0x75,0x20,0x67,0x6F,0x74,0x20,0x74,0x68,0x65,0x6D,0x0,0x74,0x75,0x20,0x61,
    0x73,0x20,0x63,0x6F,0x6D,0x70,0x72,0x69,0x73,0x0,0x74,0x75,0x20,0x6C,0x65,0x73,
    0x20,0x61,0x73,0x20,0x65,0x75,0x0
    };
    const size_t sizeof_strings = 169;
#if 0
    /* test file */
    FILE* f;
#endif

    p_l10n_Translations t;

#ifndef P_NO_MEMPOOL
    p_mempool_set( &mp );
    p_mempool_init( &mp, 0 );
#endif

    P_ASSERT( p_l10n_init( &t ) )
    P_ASSERT( p_l10n_load_vector( &t, strings, sizeof_strings ) )

    _p_l10n_t = &t;

    P_ASSERT( !strcmp( p_i18n( "Hello Translation" ), "Guten Tag" ))
    P_ASSERT( !strcmp( p_i18n_c( "Contextual information", "Click here" ), "Click da" ))
    P_ASSERT( !strcmp( p_i18n_p( "I am", "We are", 1 ), "Ich bin" ))
    P_ASSERT( !strcmp( p_i18n_p( "I am", "We are", 2 ), "Wir sind" ))
    P_ASSERT( !strcmp( p_i18n_cp( "Complicated", "you got it", "you got them", 1 ), "tu as compris" ))
    P_ASSERT( !strcmp( p_i18n_cp( "Complicated", "you got it", "you got them", 2 ), "tu les as eu" ))

    p_l10n_fini( &t, P_FALSE );

#if 0 /* testing file */
    P_ASSERT( ( f = fopen( "example.tr.txt", "r" )))
    P_ASSERT( p_l10n_init( &t ) )
    P_ASSERT( p_l10n_load_file( &t, f ))

    p_l10n_fini( &t, P_TRUE );
#endif

#ifndef P_NO_MEMPOOL
    p_mempool_debug( &mp );
    p_mempool_fini( &mp );
    p_mempool_debug( &mp );
#endif
    return 0;
}

int main( int argc, char* argv[] )
{
    P_UNUSED( argc );
    P_UNUSED( argv );
    return p_l10n_test();
}

/* vi: set fenc=utf-8 ff=unix et sw=4 ts=4 sts=4 : */
